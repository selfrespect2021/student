<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†ØªØ§Ø¦Ø¬ Ù…Ø¯Ø±Ø³Ø© Ø·Ù‡ Ø­Ø³ÙŠÙ† - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù„ÙƒØ§Ù†ÙŠ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; max-width: 800px; margin: auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        input[type="text"] { padding: 15px; width: 60%; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1em; text-align: center; margin-bottom: 10px; }
        button { background: var(--accent); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.1em; width: 80%; }
        .result-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .result-table th, .result-table td { border: 1px solid #eee; padding: 10px; text-align: center; }
        .result-table th { background: var(--primary); color: white; }
        .student-info { background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0; font-weight: bold; font-size: 1.3em; color: #d35400; }
        .admin-panel { margin-top: 40px; padding: 20px; border: 2px dashed #bbb; border-radius: 15px; background: #fafafa; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“Š Ù…Ù†Ø¸ÙˆÙ…Ø© Ù†ØªØ§Ø¦Ø¬ Ù…Ø¯Ø±Ø³Ø© Ø·Ù‡ Ø­Ø³ÙŠÙ†</h2>
    <p>Ø§Ù„Ø£Ø³ØªØ§Ø°: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø¨Ù„ÙƒØ§Ù†ÙŠ</p>

    <div class="admin-panel">
        <label>1ï¸âƒ£ Ø§Ø±ÙØ¹ Ù…Ù„Ù (note final.xlsx) Ø£ÙˆÙ„Ø§Ù‹:</label><br><br>
        <input type="file" id="fileUploader" accept=".xlsx, .xls, .csv">
        <div id="uploadStatus" style="margin-top:10px; font-weight:bold; color:green;"></div>
    </div>

    <div style="margin-top: 30px;">
        <label>2ï¸âƒ£ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ø³Ø§Ø± (Ù…Ø«Ø§Ù„: G202028872):</label><br><br>
        <input type="text" id="massarSearch" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ù‡Ù†Ø§">
        <button onclick="getResult()">Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ù†Ù‚Ø·</button>
    </div>

    <div id="outputArea"></div>
</div>

<script>
    let db = {};
    const subLabels = ["PO2", "V1", "V2", "CO1", "CO2", "LF2", "LC1", "LC2", "LC3", "LC4", "PE1", "PE2", "OL1", "OL2", "Ø§Ù„Ù…Ø¹Ø¯Ù„"];

    document.getElementById('fileUploader').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.target.result);
            const wb = XLSX.read(data, {type: 'array'});
            const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header: 1});

            db = {};
            rows.forEach((row) => {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… Ù…Ø³Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ (Index 1) Ø£Ùˆ Ø§Ù„Ø«Ø§Ù„Ø« (Index 2)
                let possibleId = String(row[1] || row[2]).trim().toUpperCase();
                if (possibleId.startsWith('G')) {
                    db[possibleId] = {
                        name: row[2] || row[3], // Ø§Ù„Ø§Ø³Ù…
                        class: row[3] || row[4], // Ø§Ù„Ù‚Ø³Ù…
                        marks: row.slice(4, 19)  // Ø§Ù„Ù†Ù‚Ø· ØªØ¨Ø¯Ø£ Ù…Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø³Ù…
                    };
                }
            });

            const count = Object.keys(db).length;
            document.getElementById('uploadStatus').innerText = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ " + count + " ØªÙ„Ù…ÙŠØ° Ø¨Ù†Ø¬Ø§Ø­!";
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    });

    function getResult() {
        const id = document.getElementById('massarSearch').value.trim().toUpperCase();
        const area = document.getElementById('outputArea');
        const s = db[id];

        if (!s) {
            area.innerHTML = "<p style='color:red; margin-top:20px;'>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.</p>";
            return;
        }

        let html = `<div class="student-info">Ø§Ù„ØªÙ„Ù…ÙŠØ°(Ø©): ${s.name} <br> Ø§Ù„Ù‚Ø³Ù…: ${s.class}</div>`;
        html += `<table class="result-table"><thead><tr><th>Ø§Ù„Ù…ÙƒÙˆÙ†</th><th>Ø§Ù„Ù†Ù‚Ø·Ø©</th></tr></thead><tbody>`;
        subLabels.forEach((name, i) => {
            html += `<tr><td>${name}</td><td>${s.marks[i] || 0}</td></tr>`;
        });
        html += `</tbody></table>`;
        area.innerHTML = html;
    }
</script>
</body>
</html>
