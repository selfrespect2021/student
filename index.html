<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†ØªØ§Ø¦Ø¬ Ù…Ø¯Ø±Ø³Ø© Ø·Ù‡ Ø­Ø³ÙŠÙ† - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù„ÙƒØ§Ù†ÙŠ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --p: #2c3e50; --a: #2980b9; --s: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .card { background: white; max-width: 800px; margin: auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        input[type="text"] { padding: 15px; width: 60%; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1em; text-align: center; }
        button { background: var(--a); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1.1em; }
        .result-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .result-table th, .result-table td { border: 1px solid #eee; padding: 10px; text-align: center; }
        .result-table th { background: var(--p); color: white; }
        .student-info { background: #fff3cd; padding: 15px; border-radius: 10px; margin: 20px 0; font-weight: bold; font-size: 1.3em; color: #d35400; }
        .admin { margin-top: 40px; padding: 20px; border: 2px dashed #bbb; border-radius: 15px; background: #fafafa; }
        .success { color: var(--s); font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ“Š Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h2>
    <p>Ù…Ø¯Ø±Ø³Ø© Ø·Ù‡ Ø­Ø³ÙŠÙ† | Ø§Ù„Ø£Ø³ØªØ§Ø°: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø¨Ù„ÙƒØ§Ù†ÙŠ</p>

    <div class="admin">
        <label>1ï¸âƒ£ Ø§Ø±ÙØ¹ Ù…Ù„Ù (note final) Ø£ÙˆÙ„Ø§Ù‹:</label><br><br>
        <input type="file" id="fileIn" accept=".xlsx, .xls, .csv">
        <div id="status" class="success"></div>
    </div>

    <div style="margin-top: 30px;">
        <label>2ï¸âƒ£ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ø³Ø§Ø± Ù„Ù„Ø¨Ø­Ø«:</label><br><br>
        <input type="text" id="massarId" placeholder="Ù…Ø«Ù„Ø§Ù‹: G123456789">
        <button onclick="search()">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>

    <div id="output"></div>
</div>

<script>
    let studentsData = {};
    const subNames = ["PO2", "V1", "V2", "CO1", "CO2", "LF2", "LC1", "LC2", "LC3", "LC4", "PE1", "PE2", "OL1", "OL2", "Ø§Ù„Ù…Ø¹Ø¯Ù„"];

    document.getElementById('fileIn').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = new Uint8Array(event.result || event.target.result);
            const wb = XLSX.read(data, {type: 'array'});
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(sheet, {header: 1});

            studentsData = {};
            // Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ø§Ù„Ø³Ø·Ø± 20 ÙÙ…Ø§ ÙÙˆÙ‚ Ù„Ø¶Ù…Ø§Ù† ØªØ¬Ø§ÙˆØ² Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ÙØ§Ø±ØºØ©
            rows.forEach(row => {
                // ÙÙŠ Ù…Ù„ÙÙƒ: Ø±Ù‚Ù… Ù…Ø³Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù„Ø« (Index 2)
                if (row && row[2] && String(row[2]).startsWith('G')) {
                    let id = String(row[2]).trim().toUpperCase();
                    studentsData[id] = {
                        name: row[3], // Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø±Ø§Ø¨Ø¹
                        class: row[4], // Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø®Ø§Ù…Ø³
                        marks: row.slice(5, 20) // Ø§Ù„Ù†Ù‚Ø· ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø³Ø§Ø¯Ø³
                    };
                }
            });

            const count = Object.keys(studentsData).length;
            if(count > 0) {
                document.getElementById('status').innerText = "âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª " + count + " ØªÙ„Ù…ÙŠØ°.";
            } else {
                document.getElementById('status').innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù„Ù.";
                document.getElementById('status').style.color = "red";
            }
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    });

    function search() {
        const id = document.getElementById('massarId').value.trim().toUpperCase();
        const out = document.getElementById('output');
        const s = studentsData[id];

        if (!s) {
            out.innerHTML = "<p style='color:red; margin-top:20px;'>âŒ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆÙ…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ù‚Ù… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.</p>";
            return;
        }

        let html = `<div class="student-info">Ø§Ù„ØªÙ„Ù…ÙŠØ°(Ø©): ${s.name} <br> Ø§Ù„Ù‚Ø³Ù…: ${s.class}</div>`;
        html += `<table class="result-table"><thead><tr><th>Ø§Ù„Ù…ÙƒÙˆÙ†</th><th>Ø§Ù„Ù†Ù‚Ø·Ø©</th></tr></thead><tbody>`;
        
        subNames.forEach((name, i) => {
            html += `<tr><td>${name}</td><td>${s.marks[i] || 0}</td></tr>`;
        });

        html += `</tbody></table>`;
        out.innerHTML = html;
    }
</script>
</body>
</html>
